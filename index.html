<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –∫–ª–∞—Å—Å–∞ Init</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        table {
            border-collapse: collapse;
            margin: 20px 0;
            width: 100%;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
        }
        pre {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
        }
        .error {
            color: red;
            padding: 10px;
            border: 1px solid red;
            background: #ffe6e6;
        }
    </style>
</head>
<body>
    <div class="container">
        <h2>–î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è —Ä–∞–±–æ—Ç—ã –∫–ª–∞—Å—Å–∞ Init (JavaScript –≤–µ—Ä—Å–∏—è)</h2>
        
        <div id="fileInfo">
            <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ñ–∞–π–ª–µ –±—É–¥–µ—Ç –∑–¥–µ—Å—å -->
        </div>

        <h3>–°–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞:</h3>
        <pre id="fileContent">–î–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏...</pre>

        <h3>–û—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (normal –∏ success):</h3>
        <div id="filteredResults">
            <!-- –û—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç –∑–¥–µ—Å—å -->
        </div>

        <h3>–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:</h3>
        <div id="stats">
            <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –±—É–¥–µ—Ç –∑–¥–µ—Å—å -->
        </div>

        <div style="margin-top: 20px;">
            <button onclick="generateData()">üîÑ –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ</button>
            <button onclick="location.reload()">üîÑ –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É</button>
        </div>
    </div>

    <script>
        // –ö–ª–∞—Å—Å Init –Ω–∞ JavaScript
        class Init {
            constructor() {
                this.data = [];
                this.filename = 'demo_data';
            }

            // –°–æ–∑–¥–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
            create() {
                const results = ['normal', 'illegal', 'failed', 'success'];
                this.data = [];

                for (let i = 1; i <= 10; i++) {
                    const scriptName = 'script_' + Math.random().toString(36).substr(2, 10);
                    const startTime = Math.floor(Date.now() / 1000) - Math.floor(Math.random() * 82800) + 3600;
                    const endTime = startTime + Math.floor(Math.random() * 3540) + 60;
                    const result = results[Math.floor(Math.random() * results.length)];

                    this.data.push({
                        id: i,
                        script_name: scriptName,
                        start_time: this.formatTimestamp(startTime),
                        end_time: this.formatTimestamp(endTime),
                        result: result
                    });
                }
                
                this.saveToLocalStorage();
                return this.data;
            }

            // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏
            formatTimestamp(timestamp) {
                return new Date(timestamp * 1000).toLocaleString('ru-RU');
            }

            // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ localStorage
            saveToLocalStorage() {
                let content = "id|script_name|start_time|end_time|result\n";
                this.data.forEach(row => {
                    content += `${row.id}|${row.script_name}|${row.start_time}|${row.end_time}|${row.result}\n`;
                });
                
                localStorage.setItem('init_data', content);
                return content;
            }

            // –ß—Ç–µ–Ω–∏–µ –∏–∑ localStorage
            readFromLocalStorage() {
                const content = localStorage.getItem('init_data');
                if (!content) return [];

                const lines = content.trim().split('\n');
                lines.shift(); // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫

                const data = [];
                lines.forEach(line => {
                    if (line.trim()) {
                        const parts = line.split('|');
                        if (parts.length === 5) {
                            data.push({
                                id: parts[0],
                                script_name: parts[1],
                                start_time: parts[2],
                                end_time: parts[3],
                                result: parts[4]
                            });
                        }
                    }
                });
                
                return data;
            }

            // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
            get() {
                const allData = this.readFromLocalStorage();
                return allData.filter(row => 
                    row.result === 'normal' || row.result === 'success'
                );
            }

            // –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ "—Ñ–∞–π–ª–µ"
            getFileInfo() {
                const content = localStorage.getItem('init_data');
                return {
                    '–ò–º—è —Ñ–∞–π–ª–∞': 'demo_data.txt',
                    '–†–∞–∑–º–µ—Ä': content ? content.length + ' –±–∞–π—Ç' : '0 –±–∞–π—Ç',
                    '–í—Ä–µ–º—è –∏–∑–º–µ–Ω–µ–Ω–∏—è': new Date().toLocaleString('ru-RU'),
                    '–°—Ç–∞—Ç—É—Å': content ? '–°–æ–∑–¥–∞–Ω' : '–ù–µ —Å–æ–∑–¥–∞–Ω'
                };
            }
        }

        // –°–æ–∑–¥–∞–µ–º —ç–∫–∑–µ–º–ø–ª—è—Ä –∫–ª–∞—Å—Å–∞
        const init = new Init();

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ñ–∞–π–ª–µ
        function displayFileInfo() {
            const fileInfo = init.getFileInfo();
            let html = '<h4>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ñ–∞–π–ª–µ:</h4><ul>';
            for (const [key, value] of Object.entries(fileInfo)) {
                html += `<li><strong>${key}:</strong> ${value}</li>`;
            }
            html += '</ul>';
            document.getElementById('fileInfo').innerHTML = html;
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ —Ñ–∞–π–ª–∞
        function displayFileContent() {
            const content = localStorage.getItem('init_data');
            document.getElementById('fileContent').textContent = content || '–§–∞–π–ª –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç';
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
        function displayFilteredResults() {
            const results = init.get();
            
            if (results.length === 0) {
                document.getElementById('filteredResults').innerHTML = '<p>–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è</p>';
                return;
            }

            let html = '<table><thead><tr>';
            
            // –ó–∞–≥–æ–ª–æ–≤–∫–∏ —Ç–∞–±–ª–∏—Ü—ã
            Object.keys(results[0]).forEach(column => {
                html += `<th>${column}</th>`;
            });
            
            html += '</tr></thead><tbody>';
            
            // –î–∞–Ω–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã
            results.forEach(row => {
                html += '<tr>';
                Object.values(row).forEach(value => {
                    html += `<td>${value}</td>`;
                });
                html += '</tr>';
            });
            
            html += '</tbody></table>';
            document.getElementById('filteredResults').innerHTML = html;
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        function displayStats() {
            const allData = init.readFromLocalStorage();
            const filteredData = init.get();
            
            document.getElementById('stats').innerHTML = `
                <p><strong>–ù–∞–π–¥–µ–Ω–æ –∑–∞–ø–∏—Å–µ–π:</strong> ${filteredData.length} –∏–∑ ${allData.length}</p>
                <p><strong>–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å:</strong> ${allData.length > 0 ? Math.round((filteredData.length / allData.length) * 100) : 0}%</p>
            `;
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö
        function generateData() {
            init.create();
            displayFileInfo();
            displayFileContent();
            displayFilteredResults();
            displayStats();
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.addEventListener('load', function() {
            // –ï—Å–ª–∏ –¥–∞–Ω–Ω—ã—Ö –Ω–µ—Ç, –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º –∏—Ö
            if (!localStorage.getItem('init_data')) {
                generateData();
            } else {
                displayFileInfo();
                displayFileContent();
                displayFilteredResults();
                displayStats();
            }
        });
    </script>
</body>
</html>

